<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cat√°logo de Canciones</title>
<style>
    body { font-family: Arial, sans-serif; background: #0f0f14; color: white; margin: 0; padding: 0; }
    header { padding: 1em; background: #1b1b24; text-align: center; font-size: 1.5em; font-weight: bold; }
    .search-bar { display: flex; justify-content: center; padding: 1em; }
    .search-bar input { width: 80%; padding: 0.5em; font-size: 1em; border-radius: 5px; border: none; }
    .songs { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1em; padding: 1em; }
    .song-card { background: #1e1e2d; padding: 1em; border-radius: 10px; cursor: pointer; }
    .song-card:hover { background: #2c2c3d; }
    .queue { padding: 1em; background: #15151f; }
    .queue h2 { margin-top: 0; }
    #topBtn, #bottomBtn { position: fixed; right: 20px; padding: 0.5em 1em; border: none; border-radius: 5px; cursor: pointer; }
    #topBtn { bottom: 70px; background: #007bff; color: white; }
    #bottomBtn { bottom: 20px; background: #28a745; color: white; }
    .delete-btn { background: red; border: none; color: white; padding: 2px 6px; margin-left: 10px; border-radius: 4px; cursor: pointer; }
</style>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
</head>
<body>

<header>üé§ Cat√°logo de canciones</header>
<div class="search-bar">
    <input type="text" id="searchInput" placeholder="Buscar por artista o t√≠tulo...">
</div>

<div class="songs" id="songsContainer"></div>

<div class="queue">
    <h2>üìú Cola de peticiones</h2>
    <ul id="queueList"></ul>
</div>

<button id="topBtn" onclick="scrollToTop()">‚¨ÜÔ∏è Arriba</button>
<button id="bottomBtn" onclick="scrollToBottom()">‚¨áÔ∏è Ver cola</button>

<script>

const firebaseConfig = {
  apiKey: "AIzaSyCAHqKUswtw9KUXhdeKs7z7WkIedI42Bk8",
  authDomain: "cola-canciones.firebaseapp.com",
  databaseURL: "https://cola-canciones-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "cola-canciones",
  storageBucket: "cola-canciones.firebasestorage.app",
  messagingSenderId: "879700000985",
  appId: "1:879700000985:web:a393153549ae031bfd3ec8"
};


// Inicializar Firebase
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database(app);

function cargarCanciones() {
  fetch('songs.json')
    .then(response => {
      if (!response.ok) throw new Error(`Error HTTP: ${response.status}`);
      return response.json();
    })
    .then(data => {
      window.songsData = data;
      mostrarCanciones(data);
    })
    .catch(error => console.error('Error cargando songs.json:', error));
}

function mostrarCanciones(canciones) {
  const contenedor = document.getElementById('songsContainer');
  contenedor.innerHTML = '';
  canciones.forEach(song => {
    const card = document.createElement('div');
    card.className = 'song-card';
    card.innerHTML = `<strong>${song.artist}</strong><br>${song.title}`;
    card.addEventListener('click', () => pedirNombre(song));
    contenedor.appendChild(card);
  });
}

function pedirNombre(song) {
  const nombre = prompt('Introduce tu nombre o nick:');
  if (!nombre) return;
  const refNueva = db.ref('cola').push();
  refNueva.set({
    usuario: nombre,
    cancion: `${song.artist} - ${song.title}`,
    timestamp: Date.now()
  });
}

function cargarCola() {
  const lista = document.getElementById('queueList');
  db.ref('cola').on('value', snapshot => {
    lista.innerHTML = '';
    snapshot.forEach(child => {
      const data = child.val();
      const li = document.createElement('li');
      li.textContent = `${data.usuario} pidi√≥ "${data.cancion}"`;
      const btnBorrar = document.createElement('button');
      btnBorrar.textContent = '‚ùå';
      btnBorrar.className = 'delete-btn';
      btnBorrar.onclick = () => {
        if (confirm('¬øEst√°s seguro de que quieres eliminar esta canci√≥n?')) {
          db.ref('cola/' + child.key).remove();
        }
      };
      li.appendChild(btnBorrar);
      lista.appendChild(li);
    });
  });
}

document.getElementById('searchInput').addEventListener('input', e => {
  const term = e.target.value.toLowerCase();
  const filtradas = window.songsData.filter(s => 
    s.artist.toLowerCase().includes(term) || s.title.toLowerCase().includes(term)
  );
  mostrarCanciones(filtradas);
});

function scrollToTop() { window.scrollTo({ top: 0, behavior: 'smooth' }); }
function scrollToBottom() { window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }); }

cargarCanciones();
cargarCola();
</script>

</body>
</html>
