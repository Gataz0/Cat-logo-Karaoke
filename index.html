<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>üé§ Cat√°logo de canciones</title>
<style>
    :root{
      --bg:#121218;
      --panel:#16161f;
      --card:#1b1b26;
      --muted:#9aa0a6;
      --accent:#6ee7b7;
      --danger:#f87171;
      --text:#e5e7eb;
      --outline:#2a2a3a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1000px 600px at 70% -200px, #1b1b26, #121218 60%),
                  radial-gradient(1000px 600px at 0% 120%, #16161f, #121218 60%);
      color:var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    .container{max-width:1280px; margin:0 auto; padding:28px 16px 80px}
    .title{display:flex; align-items:center; gap:10px; font-size:22px; font-weight:700; letter-spacing:.2px; margin-bottom:16px}
    .title .dot{width:8px;height:8px;background:#a78bfa;border-radius:999px;box-shadow:0 0 16px #a78bfaaa}
    .search-bar{display:flex; gap:10px; align-items:center; margin:10px 0 18px}
    .search-input{
      flex:1; padding:14px 16px; border-radius:10px; border:1px solid var(--outline);
      background:#0f0f15; color:var(--text); font-size:14px; outline:none;
    }
    .grid{display:grid; grid-template-columns:repeat(4,1fr); gap:14px}
    @media (max-width:1100px){ .grid{grid-template-columns:repeat(3,1fr)} }
    @media (max-width:800px){ .grid{grid-template-columns:repeat(2,1fr)} }
    @media (max-width:520px){ .grid{grid-template-columns:1fr} }
    .card{
      background:linear-gradient(180deg, #191a24, #151520);
      border:1px solid var(--outline);
      border-radius:12px; padding:12px 14px; cursor:pointer;
      transition:transform .08s ease, border-color .2s ease, box-shadow .2s ease;
    }
    .card:hover{ transform:translateY(-1px); border-color:#2f3144; box-shadow:0 8px 24px rgba(0,0,0,.25) }
    .artist{font-weight:700; margin-bottom:6px; color:#c7d2fe}
    .title-song{font-size:13px; color:#d1d5db}
    .section{margin-top:22px; background:var(--panel); border:1px solid var(--outline); border-radius:14px}
    .section h3{margin:0; padding:12px 14px; font-size:15px; font-weight:700; border-bottom:1px solid var(--outline)}
    .queue{padding:8px 6px}
    .q-item{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:10px 12px; border-radius:10px; border:1px solid var(--outline); background:#14141f; margin:8px;
    }
    .q-item .who{font-weight:600; color:#a3e635; margin-right:6px}
    .q-item .song{color:#e5e7eb}
    .q-actions{display:flex; gap:8px}
    .btn{
      appearance:none; border:1px solid var(--outline); background:#0f0f15;
      color:var(--text); padding:8px 10px; border-radius:10px; font-size:12px; cursor:pointer;
    }
    .btn:hover{border-color:#2f3144}
    .btn-danger{background:#231a1d; border-color:#3a2026}
    .btn-danger:hover{background:#2a1f23; border-color:#4b2630}
    .fab{
      position:fixed; right:16px; bottom:16px; display:flex; flex-direction:column; gap:10px; z-index:20;
    }
    .chip{border-radius:999px; padding:8px 12px; background:#2563eb; color:white; border:1px solid #1e40af; font-size:12px; font-weight:600}
    .notif{
      position:fixed; left:50%; top:16%; transform:translate(-50%,-50%) scale(.96);
      background:#0f0f15; border:1px solid var(--outline); padding:12px 16px; border-radius:12px;
      display:none; align-items:center; gap:10px; z-index:50; box-shadow:0 12px 40px rgba(0,0,0,.45);
      font-weight:600;
    }
    .notif.show{display:flex; animation:pop .18s ease-out forwards}
    .notif.ok{border-color:#234231}
    .notif.err{border-color:#4b2630}
    .icon{width:18px;height:18px; display:inline-flex; align-items:center; justify-content:center; border-radius:999px}
    .ok .icon{background:rgba(34,197,94,.15)}
    .err .icon{background:rgba(239,68,68,.15)}
    @keyframes pop{to{transform:translate(-50%,-50%) scale(1)}}
  </style>
</head>
<body>
<div class="container">
<div style="position:absolute; top:16px; right:16px;">
<button class="chip" onclick="changeUsername()">Cambiar usuario</button>
</div>

<div class="title"><span>üé§</span> Cat√°logo de canciones</div>
<div class="search-bar">
<input autocomplete="off" class="search-input" id="search" placeholder="Buscar por artista o t√≠tulo..." type="text"/>
</div>
<div class="grid" id="cards"></div>
<div class="section" id="queueSection">
<h3>üìú Cola de peticiones</h3>
<div class="queue" id="queue"></div>
</div>
</div>
<div class="fab">
<button class="chip" onclick="window.scrollTo({top:0,behavior:'smooth'})">‚¨ÜÔ∏è Arriba</button>
<button class="chip" onclick="document.getElementById('queueSection').scrollIntoView({behavior:'smooth'})">üìÑ Ver cola</button>
</div>
<div class="notif" id="notif">
<span class="icon" id="notifIcon">‚úì</span>
<span id="notifText">A√±adido</span>
</div>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
    var firebaseConfig = {
      apiKey: "AIzaSyCAHqKUswtw9KUXhdeKs7z7WkIedI42Bk8",
      authDomain: "cola-canciones.firebaseapp.com",
      databaseURL: "https://cola-canciones-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "cola-canciones",
      storageBucket: "cola-canciones.firebasestorage.app",
      messagingSenderId: "879700000985",
      appId: "1:879700000985:web:a393153549ae031bfd3ec8"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let USERNAME = localStorage.getItem("karaoke_username") || "";

    function changeUsername(){
  const newName = prompt("Introduce tu nuevo nombre o nick");
  if (newName && newName.trim() !== ""){
    USERNAME = newName.trim();
    localStorage.setItem("karaoke_username", USERNAME);
    alert("Nombre de usuario cambiado a: " + USERNAME);
  }
}
function ensureUsername() {
      if (!USERNAME) {
        USERNAME = prompt("Introduce tu nombre o nick") || "";
        if (USERNAME.trim() === "") return false;
        localStorage.setItem("karaoke_username", USERNAME.trim());
      }
      return true;
    }

    function notify(ok, msg){
      const n = document.getElementById("notif");
      const t = document.getElementById("notifText");
      const i = document.getElementById("notifIcon");
      t.textContent = msg || (ok ? "A√±adido" : "Error");
      n.className = "notif " + (ok ? "ok":"err") + " show";
      i.textContent = ok ? "‚úì" : "‚úï";
      setTimeout(()=>{ n.className = "notif"; }, 1000);
    }

    let ALL_SONGS = [];
    async function loadSongs(){
      const res = await fetch("songs.json");
      ALL_SONGS = await res.json();
      renderSongs(ALL_SONGS);
    }
    function renderSongs(list){
      const wrap = document.getElementById("cards");
      wrap.innerHTML = "";
      for(const s of list){
        const el = document.createElement("button");
        el.className = "card";
        el.setAttribute("type","button");
        el.innerHTML = '<div class="artist">'+escapeHtml(s.artist)+'</div><div class="title-song">'+escapeHtml(s.title)+'</div>';
        el.addEventListener("click", ()=> onPickSong(s));
        wrap.appendChild(el);
      }
    }
    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    async function onPickSong(s){
      if (!ensureUsername()) return;
      const full = s.artist + " ‚Äî " + s.title;
      try{
        await db.ref("queue").push({
          user: USERNAME,
          song: full,
          time: Date.now()
        });
        notify(true, "A√±adido a la cola");
      }catch(e){
        notify(false, "No se pudo a√±adir");
        console.error(e);
      }
    }

    document.getElementById("search").addEventListener("input", e=>{
      const q = e.target.value.trim().toLowerCase();
      if (!q){ renderSongs(ALL_SONGS); return; }
      const f = ALL_SONGS.filter(s =>
        s.artist.toLowerCase().includes(q) || s.title.toLowerCase().includes(q)
      );
      renderSongs(f);
    });

    const queueRef = db.ref("queue");
    queueRef.on("value", snap => {
      const list = [];
      snap.forEach(ch => list.push({key: ch.key, ...ch.val()}));
      list.sort((a,b)=> a.time - b.time);
      renderQueue(list);
    });

    function renderQueue(items){
      const root = document.getElementById("queue");
      root.innerHTML = "";
      if (items.length === 0){
        const empty = document.createElement("div");
        empty.style.color = "var(--muted)";
        empty.style.padding = "12px 16px";
        empty.textContent = "Sin canciones en cola.";
        root.appendChild(empty);
        return;
      }
      for(const it of items){
        const row = document.createElement("div");
        row.className = "q-item";
        const left = document.createElement("div");
        left.innerHTML = '<span class="who">'+escapeHtml(it.user)+'</span><span class="song">'+escapeHtml(it.song)+'</span>';
        row.appendChild(left);

        const actions = document.createElement("div");
        actions.className = "q-actions";

        const del = document.createElement("button");
        del.className = "btn btn-danger";
        del.textContent = "üóë Borrar";
        del.addEventListener("click", async ()=>{
          if (!confirm("¬øEst√°s seguro de que quieres borrar esta canci√≥n?")) return;
          try{
            await db.ref("queue/"+it.key).remove();
          }catch(e){
            notify(false, "No se pudo borrar");
            console.error(e);
          }
        });
        actions.appendChild(del);

        row.appendChild(actions);
        root.appendChild(row);
      }
    }

    loadSongs();
  </script>
</body>
</html>
