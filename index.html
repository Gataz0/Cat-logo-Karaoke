<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>🎤 Catálogo de canciones</title>
<style>
    body { background-color: #14141a; color: white; font-family: Arial, sans-serif; }
    h1 { text-align: center; }
    input { width: 80%; padding: 10px; margin: 10px auto; display: block; border-radius: 5px; border: none; }
    .song { padding: 10px; border-bottom: 1px solid #333; cursor: pointer; }
    .song:hover { background-color: #1e1e28; }
    .queue-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #333; }
    button { background: red; border: none; padding: 5px 10px; border-radius: 5px; color: white; cursor: pointer; }
    button:hover { background: darkred; }
</style>
</head>
<body>

<h1>🎤 Catálogo de canciones</h1>
<input type="text" id="search" placeholder="Buscar por artista o título...">

<div id="song-list"></div>

<h2>📜 Cola de peticiones</h2>
<div id="queue"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
  var firebaseConfig = {
    apiKey: "AIzaSyCAHqKUswtw9KUXhdeKs7z7WkIedI42Bk8",
    authDomain: "cola-canciones.firebaseapp.com",
    databaseURL: "https://cola-canciones-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "cola-canciones",
    storageBucket: "cola-canciones.firebasestorage.app",
    messagingSenderId: "879700000985",
    appId: "1:879700000985:web:a393153549ae031bfd3ec8"
  };
  firebase.initializeApp(firebaseConfig);
  var db = firebase.database();

  let username = localStorage.getItem("username");

  async function loadSongs() {
    let res = await fetch("songs.json");
    let songs = await res.json();
    displaySongs(songs);
  }

  function displaySongs(songs) {
    const list = document.getElementById("song-list");
    list.innerHTML = "";
    songs.forEach(song => {
      const div = document.createElement("div");
      div.className = "song";
      div.textContent = `${song.artist} - ${song.title}`;
      div.onclick = () => addToQueue(song.artist + " - " + song.title);
      list.appendChild(div);
    });
  }

  function addToQueue(song) {
    if (!username) {
      username = prompt("Introduce tu nombre o nick:");
      if (!username) return;
      localStorage.setItem("username", username);
    }
    db.ref("queue").push({
      user: username,
      song: song,
      time: Date.now()
    });
  }

  function renderQueue(snapshot) {
    const queueDiv = document.getElementById("queue");
    queueDiv.innerHTML = "";
    let items = [];
    snapshot.forEach(child => {
      items.push({ key: child.key, ...child.val() });
    });
    // Ordenar por fecha (más antiguas primero)
    items.sort((a, b) => a.time - b.time);
    items.forEach(item => {
      const div = document.createElement("div");
      div.className = "queue-item";
      div.innerHTML = `<span>${item.user} - ${item.song}</span>`;
      
      // Solo mostrar botón de borrar si es admin o dueño
      if (username === "Gataz0" || username === item.user) {
        const btn = document.createElement("button");
        btn.textContent = "🗑";
        btn.onclick = () => {
          if (confirm("¿Estás seguro de que quieres borrar esta canción?")) {
            db.ref("queue/" + item.key).remove();
          }
        };
        div.appendChild(btn);
      }
      queueDiv.appendChild(div);
    });
  }

  document.getElementById("search").addEventListener("input", async e => {
    let term = e.target.value.toLowerCase();
    let res = await fetch("songs.json");
    let songs = await res.json();
    let filtered = songs.filter(s => 
      s.artist.toLowerCase().includes(term) || s.title.toLowerCase().includes(term)
    );
    displaySongs(filtered);
  });

  db.ref("queue").on("value", renderQueue);
  loadSongs();
</script>

</body>
</html>
